(()=>{var H=typeof require!="undefined"?require:e=>{throw new Error('Dynamic require of "'+e+'" is not supported')};var x=(e,t)=>()=>(e&&(t=e(e=0)),t);var S=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);function w(e,t){return new f(e,t)}function d(e,...t){return new b(e,t)}function C(e){return{fn:e}}function m(e){return{fn:e}}function u(e,t,n,o){return new y(e,t,n,o)}function G(e,t,n,o,c){return new h(e,t,n,o,c)}function v(e,t,n,o,c){let I=o||e.states[0].id;return new M(I,e,t,n,c)}var y,h,b,f,g,M,l=x(()=>{y=class{constructor(t,n,o,c){this.how=t;this.where=n;this.reducer=o;this.guard=c}},h=class{constructor(t,n,o,c,I){this.how=t;this.guard=n;this.where=o;this.error=c;this.reducer=I}},b=class{constructor(t,n){this.id=t;this.transitions=n}},f=class{constructor(t,n){this.states=t;this.makeCtx=n}},g=class{constructor(t){this.service=t}get current(){return this.service.machine.states.find(n=>n.id===this.service.state)||this.service.machine.states[0]}},M=class{constructor(t,n,o=r=>{},c=r=>{},I){this.state=t;this.machine=n;this.onStateChange=o;this.onContextChange=c;this.makeCtx=I;this.states=new g(this),this.context=this.resetContext()}resetContext(){return this.makeCtx?this.makeCtx():this.machine.makeCtx()}setState(t){this.state=t,this.onStateChange(this.states.current)}setContext(t){this.context=t,this.onContextChange(this.context)}send(t,n={}){let o=this.states.current.transitions.find(c=>c.how===t);if(o){let c={payload:n,type:o.how};if(o.guard&&!o.guard.fn(this.context,c)){if(!o?.error)return;this.setState(o.error)}else this.setState(o.where);if(o.reducer){let I=o.reducer.fn(this.context,c);this.setContext(o.reducer.fn(this.context,c))}}}}});var i,a,p=x(()=>{(function(o){o[o.LOGIN_SCREEN=0]="LOGIN_SCREEN",o[o.HUB_SCREEN=1]="HUB_SCREEN",o[o.GAME_SCREEN=2]="GAME_SCREEN"})(i||(i={}));(function(r){r[r.LOGIN=0]="LOGIN",r[r.LOGOUT=1]="LOGOUT",r[r.JOIN=2]="JOIN",r[r.PLAY=3]="PLAY",r[r.LEAVE=4]="LEAVE",r[r.END_GAME=5]="END_GAME"})(a||(a={}))});var P,E,O,_,A,N,k,L,R=x(()=>{l();p();P=()=>({pseudo:"",room:"",life:0,x:0,y:0}),E=(e,t)=>e?.pseudo!==t?.payload?.pseudo,O=e=>e?.life===0,_=(e,t)=>({...e,pseudo:t?.payload?.pseudo??""}),A=e=>({...e,life:3,x:10,y:10}),N=e=>({...e,life:0,x:0,y:0,room:""}),k=(e,t)=>({...e,life:t?.payload?.life,x:t?.payload?.x,y:t?.payload?.y}),L=w([d(i.LOGIN_SCREEN,G(a.LOGIN,m(E),i.HUB_SCREEN,i.LOGIN_SCREEN,C(_))),d(i.HUB_SCREEN,u(a.LOGOUT,i.LOGIN_SCREEN,C(P)),u(a.JOIN,i.GAME_SCREEN,C(A))),d(i.GAME_SCREEN,u(a.LEAVE,i.HUB_SCREEN,C(N)),u(a.PLAY,i.GAME_SCREEN,C(k)),u(a.END_GAME,i.GAME_SCREEN,C(A),m(O)))],P)});var B=S(()=>{l();p();R();var s=async e=>new Promise(t=>{globalThis.setTimeout(()=>(console.log("---------------------------"),t(null)),e)}),U=async()=>{let n=v(L,o=>{console.log("on state change : ",o)},o=>{console.log("on ctx change : ",o)});for(console.log("service just create : ",n),await s(500),n.send(a.LOGIN,{pseudo:"truc"}),await s(500),console.log("event login send",n),await s(500),n.send(a.JOIN),await s(500),console.log("event join send",n);n.context.life>0;)await s(500),n.send(a.PLAY,{life:n.context.life-1,x:n.context.x+1,y:n.context.y-1}),await s(500),console.log("event play send",n);await s(500),n.send(a.END_GAME),await s(500),console.log("event endgame send",n),await s(500),n.send(a.LEAVE),await s(500),console.log("event leave send",n),await s(500),n.send(a.LOGOUT),await s(500),console.log("event logout send",n),await s(500)};document.addEventListener("readystatechange",()=>{(window.addEventListener?window:document).addEventListener("load",U,!1)})});B();})();
