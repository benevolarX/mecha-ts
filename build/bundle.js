(()=>{var l=class{constructor(t,n,o,r){this.how=t;this.where=n;this.reducer=o;this.guard=r}},m=class{constructor(t,n,o,r,I){this.how=t;this.guard=n;this.where=o;this.error=r;this.reducer=I}},h=class{constructor(t,n){this.id=t;this.transitions=n}},p=class{constructor(t,n){this.states=t;this.makeCtx=n}},y=class{constructor(t){this.service=t}get current(){return this.service.machine.states.find(n=>n.id===this.service.state)||this.service.machine.states[0]}},b=class{constructor(t,n,o=a=>{},r=a=>{},I){this.state=t;this.machine=n;this.onStateChange=o;this.onContextChange=r;this.makeCtx=I;this.states=new y(this),this.context=this.resetContext()}resetContext(){return this.makeCtx?this.makeCtx():this.machine.makeCtx()}setState(t){this.state=t,this.onStateChange(this.states.current)}setContext(t){this.context=t,this.onContextChange(this.context)}send(t,n={}){let o=this.states.current.transitions.find(r=>r.how===t);if(o){let r={payload:n,type:o.how};if(o.guard&&!o.guard.fn(this.context,r)){if(!o?.error)return;this.setState(o.error)}else this.setState(o.where);if(o.reducer){let I=o.reducer.fn(this.context,r);this.setContext(o.reducer.fn(this.context,r))}}}};function f(e,t){return new p(e,t)}function d(e,...t){return new h(e,t)}function C(e){return{fn:e}}function x(e){return{fn:e}}function u(e,t,n,o){return new l(e,t,n,o)}function g(e,t,n,o,r){return new m(e,t,n,o,r)}function w(e,t,n,o,r){let I=o||e.states[0].id;return new b(I,e,t,n,r)}var c;(function(o){o[o.LOGIN_SCREEN=0]="LOGIN_SCREEN",o[o.HUB_SCREEN=1]="HUB_SCREEN",o[o.GAME_SCREEN=2]="GAME_SCREEN"})(c||(c={}));var i;(function(a){a[a.LOGIN=0]="LOGIN",a[a.LOGOUT=1]="LOGOUT",a[a.JOIN=2]="JOIN",a[a.PLAY=3]="PLAY",a[a.LEAVE=4]="LEAVE",a[a.END_GAME=5]="END_GAME"})(i||(i={}));var G=()=>({pseudo:"",room:"",life:0,x:0,y:0}),v=(e,t)=>e?.pseudo!==t?.payload?.pseudo,P=e=>e?.life===0,L=(e,t)=>({...e,pseudo:t?.payload?.pseudo??""}),M=e=>({...e,life:3,x:10,y:10}),R=e=>({...e,life:0,x:0,y:0,room:""}),A=(e,t)=>({...e,life:t?.payload?.life,x:t?.payload?.x,y:t?.payload?.y}),S=f([d(0,g(0,x(v),1,0,C(L))),d(1,u(1,0,C(G)),u(2,2,C(M))),d(2,u(4,1,C(R)),u(3,2,C(A)),u(5,2,C(M),x(P)))],G),s=async e=>new Promise(t=>{globalThis.setTimeout(()=>(console.log("---------------------------"),t(null)),e)}),O=async()=>{let n=w(S,o=>{console.log("on state change : ",o)},o=>{console.log("on ctx change : ",o)});for(console.log("service just create : ",n),await s(500),n.send(0,{pseudo:"truc"}),await s(500),console.log("event login send",n),await s(500),n.send(2),await s(500),console.log("event join send",n);n.context.life>0;)await s(500),n.send(3,{life:n.context.life-1,x:n.context.x+1,y:n.context.y-1}),await s(500),console.log("event play send",n);await s(500),n.send(5),await s(500),console.log("event endgame send",n),await s(500),n.send(4),await s(500),console.log("event leave send",n),await s(500),n.send(1),await s(500),console.log("event logout send",n),await s(500)};document.addEventListener("readystatechange",()=>{(window.addEventListener?window:document).addEventListener("load",O,!1)});})();
